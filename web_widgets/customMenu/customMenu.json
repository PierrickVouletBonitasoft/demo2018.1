{"designerVersion":"1.2.9","id":"customMenu","name":"Menu","lastUpdate":1497527123027,"template":"<div class=\"navbar navbar-inverse\" ng-class=\"{ 'navbar-fixed-top': ctrl.isSticky() }\" role=\"navigation\">\n      <div class=\"container navbar-left\" style=\"width:100%;\">\n         <div class=\"container\" style=\"width:100%;\">  \n\t\t\t<div class=\"navbar-header\">\n\t\t\t\t<a class=\"navbar-brand\">{{ctrl.applicationName | uiTranslate}}</a>\n\t\t        <button type=\"button\" ng-init=\"navCollapsed = true\" ng-click=\"navCollapsed = !navCollapsed\" class=\"navbar-toggle\">\n                   <span class=\"icon-bar\"></span>\n                   <span class=\"icon-bar\"></span>\n                   <span class=\"icon-bar\"></span>\n                </button>\n\t\t\t</div>\n\t\t\t<div collapse=\"navCollapsed\" class=\"collapse navbar-responsive-collapse navbar-collapse\">\n\t\t      <ul class=\"nav navbar-nav\">\n\t\t\t\t<li ng-class=\"{active:ctrl.pageToken===menu.applicationPageId.token}\" ng-repeat=\"menu in ctrl.filterOnParentId(-1)\" dropdown>\n\t\t\t\t\t<a ng-if=\"!ctrl.isParentMenu(menu)\" ng-href=\"../{{menu.applicationPageId.token}}/\" >{{menu.displayName | uiTranslate}}</a>            \n\t\t\t\t    <a ng-if=\"ctrl.isParentMenu(menu)\" dropdown-toggle>{{menu.displayName | uiTranslate}}<span class=\"caret\"></span></a>\n\t\t\t\t    <ul ng-if=\"ctrl.isParentMenu(menu)\" class=\"dropdown-menu\">\n\t\t\t\t\t\t<li ng-repeat=\"childMenu in ctrl.filterOnParentId(menu.id)\">\n\t\t\t\t\t\t\t<a ng-href=\"../{{childMenu.applicationPageId.token}}/\">{{childMenu.displayName | uiTranslate}}</a>\n\t\t\t\t\t\t</li>\n\t\t\t\t    </ul>\n\t\t\t\t</li>\n\t\t\t   </ul>\n\t\t\t   <div class=\"text-right\">\n                    <a class=\"iconLink\" href=\"/bonita/\" target=\"{{ properties.targetBlank ? '_blank' : '_self' }}\">\n                        <!--<img src=\"{{ properties.imgUrl }}\" alt=\"{{ properties.imgTitle }}\" title=\"{{ properties.imgTitle }}\" style=\"max-width: 37px;margin-top: 7px;\"/>-->\n                        <img style=\"margin: 2px 0;max-height: 40px;\" ng-if=\"(properties.srcType ==='Asset' &amp;&amp; properties.assetNameBonita) || (properties.srcType !== 'Asset' &amp;&amp; properties.url)\" ng-src=\"{{ (properties.srcType==='Asset')? ((environment.editor.pageId) ? 'preview/page/' + environment.editor.pageId + '/' : '' ) + 'assets/img/' + properties.assetNameBonita : properties.url }}\" alt=\"{{ properties.imgTitle }}\">\n                        <img style=\"margin: 2px 0;max-height: 40px;\" ng-if=\"!(properties.srcType ==='Asset' &amp;&amp; properties.assetNameBonita) &amp;&amp; !(properties.srcType !== 'Asset' &amp;&amp; properties.url)\" ng-src=\"data:image/svg+xml,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%2050%2020'%3E%3Cpath%20fill%3D'%23ccc'%20d%3D'M10%201v18h30V1H10zm29%2017H11V2h28v16zM20%209.1l3%203%205-7L36%2016H14l6-6.9zM18%206c0%201.1-.9%202-2%202s-2-.9-2-2%20.9-2%202-2%202%20.9%202%202z'%2F%3E%3C%2Fsvg%3E\">\n                    </a>&emsp;\n                    <a class=\"iconLink\" href=\"https://calendar.google.com/calendar/\" target=\"{{ properties.targetBlank ? '_blank' : '_self' }}\">\n                        <!--<img src=\"{{ properties.imgUrl }}\" alt=\"{{ properties.imgTitle }}\" title=\"{{ properties.imgTitle }}\" style=\"max-width: 37px;margin-top: 7px;\"/>-->\n                        <img style=\"margin: 2px 0;max-height: 40px;\" ng-if=\"(properties.srcType ==='Asset' &amp;&amp; properties.assetNameCalendarGoogle) || (properties.srcType !== 'Asset' &amp;&amp; properties.url)\" ng-src=\"{{ (properties.srcType==='Asset')? ((environment.editor.pageId) ? 'preview/page/' + environment.editor.pageId + '/' : '' ) + 'assets/img/' + properties.assetNameCalendarGoogle : properties.url }}\" alt=\"{{ properties.imgTitle }}\">\n                        <img style=\"margin: 2px 0;max-height: 40px;\" ng-if=\"!(properties.srcType ==='Asset' &amp;&amp; properties.assetNameCalendarGoogle) &amp;&amp; !(properties.srcType !== 'Asset' &amp;&amp; properties.url)\" ng-src=\"data:image/svg+xml,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%2050%2020'%3E%3Cpath%20fill%3D'%23ccc'%20d%3D'M10%201v18h30V1H10zm29%2017H11V2h28v16zM20%209.1l3%203%205-7L36%2016H14l6-6.9zM18%206c0%201.1-.9%202-2%202s-2-.9-2-2%20.9-2%202-2%202%20.9%202%202z'%2F%3E%3C%2Fsvg%3E\">\n                    </a>&emsp;\n                    <a class=\"iconLink\" href=\"https://login.salesforce.com/?locale=en\" target=\"{{ properties.targetBlank ? '_blank' : '_self' }}\">\n                        <!--<img src=\"{{ properties.imgUrl }}\" alt=\"{{ properties.imgTitle }}\" title=\"{{ properties.imgTitle }}\" style=\"max-width: 37px;margin-top: 7px;\"/>-->\n                        <img style=\"margin: 2px 0;max-height: 40px;\" ng-if=\"(properties.srcType ==='Asset' &amp;&amp; properties.assetNameSalesForce) || (properties.srcType !== 'Asset' &amp;&amp; properties.url)\" ng-src=\"{{ (properties.srcType==='Asset')? ((environment.editor.pageId) ? 'preview/page/' + environment.editor.pageId + '/' : '' ) + 'assets/img/' + properties.assetNameSalesForce : properties.url }}\" alt=\"{{ properties.imgTitle }}\">\n                        <img style=\"margin: 2px 0;max-height: 40px;\" ng-if=\"!(properties.srcType ==='Asset' &amp;&amp; properties.assetNameSalesForce) &amp;&amp; !(properties.srcType !== 'Asset' &amp;&amp; properties.url)\" ng-src=\"data:image/svg+xml,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%2050%2020'%3E%3Cpath%20fill%3D'%23ccc'%20d%3D'M10%201v18h30V1H10zm29%2017H11V2h28v16zM20%209.1l3%203%205-7L36%2016H14l6-6.9zM18%206c0%201.1-.9%202-2%202s-2-.9-2-2%20.9-2%202-2%202%20.9%202%202z'%2F%3E%3C%2Fsvg%3E\">\n                    </a>\n               </div>\n\t\t    </div>\n\t    </div>\n    </div>\n</div>\n","controller":"function WidgetlivingApplicationMenuController($scope, $http, $window) {\n    var ctrl = this;\n    var pathArray = $window.location.pathname.split( '/' ); \n    ctrl.applicationToken =  pathArray[pathArray.length-3]; \n    ctrl.pageToken =  pathArray[pathArray.length-2];\n    \n    this.isSticky = function() {\n        $window.document.body.style.paddingTop = $scope.properties.sticky ? \"70px\": \"0px\";\n        return $scope.properties.sticky;\n    }\n\n    function getApplication() {\n        return $http.get('../API/living/application/?c=1&f=token%3D'+ctrl.applicationToken);\n    }\n    \n    this.filterOnParentId = function (parentId) {\n        if(ctrl.applicationMenuList){\n            return ctrl.applicationMenuList.filter(function(menu){\n                        return menu.parentMenuId === '' + parentId;})\n        }\n        return;\n    }\n   \n    function getApplicationMenuList(applicationId) {\n        \n        $http.get('../API/living/application-menu/?c=100&f=applicationId%3D'+applicationId+'&d=applicationPageId&o=menuIndex+ASC')\n            .success(function(data) { \n                ctrl.applicationMenuList = data;\n            });\n        return applicationId;\n    }\n\n    function setTargetedUrl() {\n        $scope.properties.targetUrl = $scope.properties.contextPath+\"/portal/resource/app/\"+ctrl.applicationToken+\"/\"+ ctrl.pageToken+\"/content/\"+ $window.location.search;\n    }\n\n    ctrl.isParentMenu= function(menu) {\n        return menu.parentMenuId==-1 && menu.applicationPageId==-1;\n    };\n    \n    getApplication().then(function(response) {\n        var application = response.data[0];\n        ctrl.applicationName = application.displayName;\n        $window.document.title = application.displayName;\n        return application.id;\n    }).then(getApplicationMenuList).then(setTargetedUrl);\n}","description":"This is an example of living application menu.","custom":true,"properties":[{"label":"URL targeted by the menu","name":"targetUrl","type":"text","bond":"variable"},{"label":"Bonita context path","name":"contextPath","type":"text","defaultValue":"/bonita","bond":"expression"},{"label":"Sticky","name":"sticky","type":"boolean","defaultValue":true,"bond":"expression"},{"label":"Image Title","name":"imgTitle","type":"text","defaultValue":"Link to Bonita BPM Portal","bond":"expression"},{"label":"Target \"_blank\"","name":"targetBlank","type":"boolean","defaultValue":true,"bond":"expression"},{"label":"Source Type","name":"srcType","type":"choice","defaultValue":"URL","choiceValues":["URL","Asset"],"bond":"constant"},{"label":"Bonita Asset Name","name":"assetNameBonita","type":"text","bond":"expression"},{"label":"URL","name":"url","type":"text","bond":"expression"},{"label":"Google Calendar Asset Name","name":"assetNameCalendarGoogle","type":"text","bond":"expression"},{"label":"SalesForce Asset Name","name":"assetNameSalesForce","type":"text","bond":"expression"}],"assets":[],"requiredModules":["ui.bootstrap"],"type":"widget"}